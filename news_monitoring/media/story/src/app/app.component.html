
<!-- Add / Edit Story Modal -->
<add-update-story
  *ngIf="show"
  [isEdit]="isEdit"
  [storyToEdit]="story!"
  [allcompanies]="allCompanies"
  (closeModal)="closeModal()"
  (refreshStories)="refreshStories()"
></add-update-story>



<!-- Delete Story Modal -->
<app-delete-story
  *ngIf="showDeleteModal"
  [storyId]="storyToDeleteId!"
  (confirmDelete)="confirmDeleteStory()"
  (cancelDelete)="closeDeleteModal()"
></app-delete-story>

<!-- STORY LIST -->
<div class="story-list max-w-5xl mx-auto p-6 bg-white rounded-lg shadow-md">
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-800">Stories</h2>
    <button
      (click)="openModal()"
      class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"
    >
      Add Story
    </button>
  </div>

  <!-- Search -->
  <input
    type="text"
    placeholder="Search stories..."
    (input)="onFilterChange($any($event.target).value)"
    class="border border-gray-300 rounded-md px-4 py-2 mb-4 w-full"
  />

  <!-- Spinner -->
  <div *ngIf="isLoadingStories" class="flex justify-center items-center my-10">
    <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
  </div>

  <!-- Table -->
  <table *ngIf="!isLoadingStories" class="w-full table-auto border-collapse border border-gray-300">
    <thead class="bg-gray-100">
      <tr>
        <th class="border border-gray-300 px-4 py-2 text-left">Title</th>
        <th class="border border-gray-300 px-4 py-2 text-left">Published Date</th>
        <th class="border border-gray-300 px-4 py-2 text-left">URL</th>
        <th class="border border-gray-300 px-4 py-2 text-left">Tagged Companies</th>
        <th class="border border-gray-300 px-4 py-2 text-left">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let story of stories" class="hover:bg-gray-50">
        <td class="border border-gray-300 px-4 py-2">{{ story.title }}</td>
        <td class="border border-gray-300 px-4 py-2">{{ story.published_date | date: 'shortDate' }}</td>
        <td class="border border-gray-300 px-4 py-2">
          <a [href]="story.url" target="_blank" class="text-blue-600 hover:underline">Link</a>
        </td>
        <td class="border border-gray-300 px-4 py-2">
          <ng-container *ngIf="story.tagged_companies_details && story.tagged_companies_details.length > 0; else noCompanies">
            <span *ngFor="let company of story.tagged_companies_details; let i = index">
              {{ company.name }}<span *ngIf="i < story.tagged_companies_details.length - 1">, </span>
            </span>
          </ng-container>
          <ng-template #noCompanies>
            <span class="text-gray-500 italic">No companies tagged</span>
          </ng-template>
        </td>


        <td class="border border-gray-300 px-4 py-2">
          <div class="flex space-x-2">
            <button
              (click)="fetchStory(story.id!)"
              class="bg-yellow-400 hover:bg-yellow-600 text-white px-3 py-1 rounded"
            >
              Edit
            </button>
            <button
              (click)="openDeleteModal(story.id!)"
              class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded"
            >
              Delete
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Pagination Controls -->
<div class="mt-4 flex justify-center space-x-9">
  <button
    class="px-2 py-2 bg-blue-500 text-white rounded hover:bg-blue-700 transition focus:outline-none focus:ring-4 focus:ring-blue-400 font-semibold"
    (click)="prevPage()"
    [disabled]="!hasPrev"
  >
    Previous
  </button>

  <span class="mt-1 text-black-600 font-semibold">{{ pageNumber }}</span>

  <button
    class="px-2 py-2 bg-blue-500 text-white rounded hover:bg-blue-700 transition focus:outline-none focus:ring-4 focus:ring-blue-400 font-semibold"
    (click)="nextPage()"
    [disabled]="!hasNext"
  >
    Next
  </button>
</div>
